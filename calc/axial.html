<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jumlah Axial Radial</title>
    <style>
       body {
            font-family: 'Roboto', sans-serif;
            padding: 20px;
            margin: 0;
            background-color: #f9f9f9; /* Light Gray Background */
        }
        .card {
            border: 1px solid #ccc;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.252);
            background-color: #f7dea6; /* Alice Blue */
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        select, input, button {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f4f4f4; /* Light Gray */
        }
        .footer {
            text-align: center;
            margin-top: 20px;
            color: #333; /* Dark Gray */
        }

        /* Styling untuk link di dalam footer */
        .footer a.footer-link {
            color: #ffcc00; /* Yellow */
            text-decoration: none;
            font-weight: bold;
            margin-left: 10px;
        }

        /* Hover effect */
        .footer a.footer-link:hover {
            text-decoration: underline;
            color: #ffffff; /* White */
        }
        #riwayatSection {
            display: none; /* Awalnya disembunyikan */
        }

        /* Media Queries untuk Responsiveness */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .card {
                padding: 15px;
                margin-bottom: 15px;
            }
            .form-group {
                margin-bottom: 10px;
            }
            select, input, button {
                padding: 6px;
            }
            table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }
            th, td {
                padding: 6px;
            }
            th {
                font-size: 14px;
            }
            td {
                font-size: 14px;
            }
            .footer {
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            .card {
                padding: 10px;
                margin-bottom: 10px;
            }
            .form-group {
                margin-bottom: 5px;
            }
            select, input, button {
                padding: 4px;
            }
            table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }
            th, td {
                padding: 4px;
            }
            th {
                font-size: 12px;
            }
            td {
                font-size: 12px;
            }
            .footer {
                font-size: 12px;
            }
        }

        /* Styling untuk tombol yang dipilih */
        .selected {
            background-color: #35ad1a; /* Green */
        }

        /* Styling untuk tombol */
        button {
            background-color: #f12711; /* Tomato */
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:active {
            background-color: #ff4500; /* Orange Red */
        }
    </style>
</head>
<body>
    <h1>STOCK OPNAME AUTO INSERT</h1>

    <!-- Tombol Reset -->
    <div class="form-group">
        <button onclick="resetData()">Reset</button>
    </div>

    <!-- Lokasi dan Operator -->
    <div class="card">
        <div class="form-group">
            <label for="location_main">Lokasi:</label>
            <select id="location_main">
                <option value="AVK">AVK</option>
                <option value="RH1">RH1</option>
                <option value="RH2">RH2</option>
                <option value="RH3">RH3</option>
                <option value="RH4">RH4</option>
            </select>
        </div>
        <div class="form-group">
            <label for="operator_main">Nama Operator:</label>
            <input type="text" id="operator_main" placeholder="Masukkan nama operator">
        </div>
        <div class="form-group">
            <button onclick="toggleListBox('axial')" id="axialButton">Axial</button>
            <button onclick="toggleListBox('radial')" id="radialButton">Radial</button>
        </div>
        <div class="form-group" id="axialComponents" style="display: none;">
            <label for="listBox_axial">Komponen:</label>
            <select id="listBox_axial">
                <option value="A47MGRW2J226">A47MGRW2J226</option>
                <option value="B0BA036A0447">B0BA036A0447</option>
                <option value="B0BA039A0553">B0BA039A0553</option>
                <option value="B0BA170A0554">B0BA170A0554</option>
                <option value="B0BA180A0554">B0BA180A0554</option>
                <option value="B0BA6R2A0479">B0BA6R2A0479</option>
                <option value="B0BA027A0463">B0BA027A0463</option>
                <option value="B0BC2900004">B0BC2900004</option>
                <option value="B0EAKM000173">B0EAKM000173</option>
                <option value="B0EAKM000198">B0EAKM000198</option>
                <option value="B0EAKP000180">B0EAKP000180</option>
                <option value="B0EAKR000195">B0EAKR000195</option>
                <option value="B0EAKT000066">B0EAKT000066</option>
                <option value="B0EALM000019">B0EALM000019</option>
                <option value="B0HAMM000127">B0HAMM000127</option>
                <option value="D0AE102JA048">D0AE102JA048</option>
                <option value="D0AF105JA112">D0AF105JA112</option>
                <option value="D0BE156JA039">D0BE156JA039</option>
                <option value="D0B1R51GA004">D0B1R51GA004</option>
                <option value="D0CF224JA033">D0CF224JA033</option>
                <option value="D1AC1400A094">D1AC1400A094</option>
                <option value="D1AC1690A094">D1AC1690A094</option>
                <option value="D1AC1800A094">D1AC1800A094</option>
                <option value="D1AC2200A094">D1AC2200A094</option>
                <option value="D4CE32020001">D4CE32020001</option>
                <option value="G0C221KA0275">G0C221KA0275</option>
            </select>
        </div>
        <div class="form-group" id="radialComponents" style="display: none;">
            <label for="listBox_radial">Komponen:</label>
            <select id="listBox_radial">
                <option value="2SC5397C">2SC5397C</option>
                <option value="A321B471K501">A321B471K501</option>
                <option value="B0EAKM000117">B0EAKM000117</option>
                <option value="B1ACNF000026">B1ACNF000026</option>
                <option value="B3AAA0000608">B3AAA0000608</option>
                <option value="B3ABA0000483">B3ABA0000483</option>
                <option value="B3ABA0000966">B3ABA0000966</option>
                <option value="B3ACA0000220">B3ACA0000220</option>
                <option value="B3AFA0000161">B3AFA0000161</option>
                <option value="C0DAEZZ00003">C0DAEZZ00003</option>
                <option value="D0C1101JA020">D0C1101JA020</option>
                <option value="D0C2101JA109">D0C2101JA109</option>
                <option value="F0A2A152A010">F0A2A152A010</option>
                <option value="F0A2A272A010">F0A2A272A010</option>
                <option value="F0A2A361A010">F0A2A361A010</option>
                <option value="F0A2A472A010">F0A2A472A010</option>
                <option value="F1A3A331A078">F1A3A331A078</option>
                <option value="F1B2H472A090">F1B2H472A090</option>
                <option value="F2A0J102A030">F2A0J102A030</option>
                <option value="F2A0J221A030">F2A0J221A030</option>
                <option value="F2A0J470B584">F2A0J470B584</option>
                <option value="F2A0J471A030">F2A0J471A030</option>
                <option value="F2A1A101A025">F2A1A101A025</option>
                <option value="F2A1A101B138">F2A1A101B138</option>
                <option value="F2A1A101B726">F2A1A101B726</option>
                <option value="F2A1A221A467">F2A1A221A467</option>
                <option value="F2A1A221B727">F2A1A221B727</option>
                <option value="F2A1A331A025">F2A1A331A025</option>
                <option value="F2A1A471B300">F2A1A471B300</option>
                <option value="F2A1A471B139">F2A1A471B139</option>
                <option value="F2A1C100A207">F2A1C100A207</option>
                <option value="F2A1C101B431">F2A1C101B431</option>
                <option value="F2A1C221A030">F2A1C221A030</option>
                <option value="F2A1C331B651">F2A1C331B651</option>
                <option value="F2A1C470A030">F2A1C470A030</option>
                <option value="F2A1C470A283">F2A1C470A283</option>
                <option value="F2A1C471A030">F2A1C471A030</option>
                <option value="F2A1C471C438">F2A1C471C438</option>
                <option value="F2A1C471C264">F2A1C471C264</option>
                <option value="F2A1C560B648">F2A1C560B648</option>
                <option value="F2A1E101B358">F2A1E101B358</option>
                <option value="F2A1E101C177">F2A1E101C177</option>
                <option value="F2A1E470A453">F2A1E470A453</option>
                <option value="F2A1E471A218">F2A1E471A218</option>
                <option value="F2A1H100B287">F2A1H100B287</option>
                <option value="F2A1H100B606">F2A1H100B606</option>
                <option value="F2A1H100B390">F2A1H100B390</option>
                <option value="F2A1H100C260">F2A1H100C260</option>
                <option value="F2A1H100C453">F2A1H100C453</option>
                <option value="F2A1A101B298">F2A1A101B298</option>
                <option value="F2A1H121B610">F2A1H121B610</option>
                <option value="F2A1H121C259">F2A1H121C259</option>
                <option value="F2A1H220A536">F2A1H220A536</option>
                <option value="F2A1H2200089">F2A1H2200089</option>
                <option value="F2A1H4700081">F2A1H4700081</option>
                <option value="F2A1H2R2A726">F2A1H2R2A726</option>
                <option value="F2A0J151B488">F2A0J151B488</option>
                <option value="F2A1V470B863">F2A1V470B863</option>
                <option value="F2A2D220A391">F2A2D220A391</option>
                <option value="F2A2W4R7A153">F2A2W4R7A153</option>
                <option value="G0C330MA0112">G0C330MA0112</option>
                <option value="H2B800400007">H2B800400007</option>
                <option value="J0JYB0000009">J0JYB0000009</option>
                <option value="K0H1BB000084">K0H1BB000084</option>
                <option value="K3GE1YA00013">K3GE1YA00013</option>
                <option value="K5G102YA0079">K5G102YA0079</option>
                <option value="K5G122Y00001">K5G122Y00001</option>
                <option value="K5G251YA0081">K5G251YA0081</option>
                <option value="K5G312Y00007">K5G312Y00007</option>
                <option value="K5G501YA0081">K5G501YA0081</option>
                <option value="K5G502A00039">K5G502A00039</option>
                <option value="KTC3203YAT">KTC3203YAT</option>
                <option value="RCA0JKA221IT">RCA0JKA221IT</option>
                <option value="RCA0JKA470BT">RCA0JKA470BT</option>
                <option value="RCA0JU102IT">RCA0JU102IT</option>
                <option value="RCA1AKA101BT">RCA1AKA101BT</option>
                <option value="RCA1AKA470BT">RCA1AKA470BT</option>
                <option value="RCA1CKA220BT">RCA1CKA220BT</option>
                <option value="RCA1HKA010BT">RCA1HKA010BT</option>
                <option value="RCA1HKA0R1BT">RCA1HKA0R1BT</option>
                <option value="RCA1HKA2R2BT">RCA1HKA2R2BT</option>
            </select>
        </div>
        <div class="form-group">
            <label for="jarak_main">Jumlah Quantity:</label>
            <input type="number" id="jarak_main">
        </div>
        <div class="form-group">
            <button onclick="tambahKeTabel()">Tambah ke Tabel</button>
        </div>
    </div>

    <!-- Tabel Input -->
    <div class="card">
        <h2>Tabel Input:</h2>
        <table id="tabelInput">
            <thead>
                <tr>
                    <th>Nama Komponen</th>
                    <th>Operator</th>
                    <th>Mesin</th>
                    <th>Hasil</th>
                </tr>
            </thead>
            <tbody>
                <!-- Data akan ditambahkan di sini -->
            </tbody>
        </table>
        <div class="form-group">
            <label for="total_main">Total:</label>
            <input type="text" id="total_main" readonly>
        </div>
    </div>

    <!-- Tombol Riwayat -->
    <div class="card">
        <button onclick="showRiwayat()">Riwayat Komponen</button>
    </div>

    <!-- Bagian Riwayat (awalnya tersembunyi) -->
    <div id="riwayatSection" class="card">
        <h2>Riwayat Komponen</h2>
        <!-- Lokasi -->
        <div class="form-group">
            <label for="location_riwayat">Lokasi:</label>
            <select id="location_riwayat" onchange="filterData()">
                <option value="all">Semua</option>
                <option value="AVK">AVK</option>
                <option value="RH1">RH1</option>
                <option value="RH2">RH2</option>
                <option value="RH3">RH3</option>
                <option value="RH4">RH4</option>
            </select>
        </div>

        <!-- Tabel Riwayat -->
        <h2>Riwayat Input:</h2>
        <div style="max-height: 300px; overflow-y: auto;"> <!-- Div untuk scroll -->
            <table id="tabelRiwayat">
                <thead>
                    <tr>
                        <th>Tanggal</th>
                        <th>Nama Komponen</th>
                        <th>Operator</th>
                        <th>Mesin</th>
                        <th>Hasil</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data akan ditambahkan di sini -->
                </tbody>
            </table>
        </div>
        <div class="form-group">
            <button onclick="exportToExcel()">Export Riwayat</button>
            <button onclick="exportTotal()">Export Total</button>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        © 2025 PENS - Panasonic Collaboration
        <a href="../Panduan/panduan.html" class="footer-link">Buku Panduan Digital</a>
    </div>

    <!-- Library SheetJS untuk export Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <script>
        let tableData = {};
        let komponenTotal = {};
        let historyData = {
            'AVK': {},
            'RH1': {},
            'RH2': {},
            'RH3': {},
            'RH4': {},
        };

        let selectedLocation = 'AVK';
        let selectedOperator = '';
        let selectedComponent = '';
        let isAxialActive = false;
        let isRadialActive = false;

        document.addEventListener('DOMContentLoaded', () => {
            loadDataMain();
        });

        function loadDataMain() {
            const tableDataString = localStorage.getItem('tableData_radial');
            const komponenTotalString = localStorage.getItem('komponenTotal_radial');
            const historyDataString = localStorage.getItem('historyData_radial');

            if (tableDataString && komponenTotalString && historyDataString) {
                tableData = JSON.parse(tableDataString);
                komponenTotal = JSON.parse(komponenTotalString);
                historyData = JSON.parse(historyDataString);
                renderTable();
                updateTotal();
                renderTableRiwayat();
            }
        }

        function toggleListBox(type) {
            const axialButton = document.getElementById('axialButton');
            const radialButton = document.getElementById('radialButton');
            const axialComponents = document.getElementById('axialComponents');
            const radialComponents = document.getElementById('radialComponents');

            if (type === 'axial') {
                isAxialActive = true;
                isRadialActive = false;
                axialComponents.style.display = 'block';
                radialComponents.style.display = 'none';
                selectedComponent = document.getElementById('listBox_axial').value;
                axialButton.classList.add('selected');
                radialButton.classList.remove('selected');
            } else if (type === 'radial') {
                isAxialActive = false;
                isRadialActive = true;
                axialComponents.style.display = 'none';
                radialComponents.style.display = 'block';
                selectedComponent = document.getElementById('listBox_radial').value;
                axialButton.classList.remove('selected');
                radialButton.classList.add('selected');
            } else {
                isAxialActive = false;
                isRadialActive = false;
                axialComponents.style.display = 'none';
                radialComponents.style.display = 'none';
                selectedComponent = '';
                axialButton.classList.remove('selected');
                radialButton.classList.remove('selected');
            }
        }

function tambahKeTabel() {
    const hasil = parseInt(document.getElementById('jarak_main').value);
    const tanggal = new Date().toISOString().split('T')[0];
    const mesin = document.getElementById('location_main').value;
    const operator = document.getElementById('operator_main').value;

    if (!operator.trim()) {
        alert('Nama Operator tidak boleh kosong.');
        return; // Operator harus terisi
    }

    if (hasil && !isNaN(hasil)) {
        let komponen = selectedComponent;
        if (isAxialActive) {
            komponen = document.getElementById('listBox_axial').value;
        } else if (isRadialActive) {
            komponen = document.getElementById('listBox_radial').value;
        } else {
            alert('Pilih komponen.');
            return;
        }

        // Hapus data untuk komponen lain dari tabel input
        for (const key in tableData) {
            if (key !== komponen) {
                delete tableData[key];
            }
        }

        if (!tableData[komponen]) {
            tableData[komponen] = [];
        }

        tableData[komponen].push({
            Mesin: mesin,
            Operator: operator,
            Komponen: komponen,
            Hasil: hasil,
            Tanggal: tanggal,
        });

        if (komponenTotal[komponen]) {
            komponenTotal[komponen] += hasil;
        } else {
            komponenTotal[komponen] = hasil;
        }

        if (!historyData[mesin][komponen]) {
            historyData[mesin][komponen] = [];
        }
        historyData[mesin][komponen].push({
            Hasil: hasil,
            Tanggal: tanggal,
            Operator: operator, // Store the operator in historyData
        });

        saveData();
        renderTable(); // Render table with only the current component
        updateTotal();
        renderTableRiwayat();
    } else {
        alert('Mohon isi Quantity yang benar !');
    }
}

        function hapusData(komponen, index) {
            const mesin = document.getElementById('location_main').value;
            const hasil = tableData[komponen][index].Hasil;

            komponenTotal[komponen] -= hasil;
            tableData[komponen].splice(index, 1);

            if (tableData[komponen].length === 0) {
                delete tableData[komponen];
            }

            if (historyData[mesin][komponen]) {
                historyData[mesin][komponen].splice(index, 1);
                if (historyData[mesin][komponen].length === 0) {
                    delete historyData[mesin][komponen];
                }
            }

            saveData();
            renderTable();
            updateTotal();
            renderTableRiwayat();
        }

        function showDeleteConfirmationRiwayat(mesin, komponen, index) {
            if (confirm('Apakah Anda yakin ingin menghapus data ini dari riwayat?')) {
                hapusDataRiwayat(mesin, komponen, index);
            }
        }

        function hapusDataRiwayat(mesin, komponen, index) {
            // Hapus dari historyData
            historyData[mesin][komponen].splice(index, 1);
            if (historyData[mesin][komponen].length === 0) {
                delete historyData[mesin][komponen];
            }

            // Simpan data
            saveData();
            renderTableRiwayat(); // Refresh tabel riwayat
        }

        function renderTable() {
            const tbody = document.getElementById('tabelInput').getElementsByTagName('tbody')[0];
            tbody.innerHTML = '';

            for (const komponen in tableData) {
                tableData[komponen].forEach((row, index) => {
                    const rowElement = document.createElement('tr');
                    rowElement.innerHTML = `
                    <td>${row.Komponen}</td>
                    <td>${row.Operator}</td>
                    <td>${row.Mesin}</td>
                    <td>${row.Hasil}</td>
                `;
                    tbody.appendChild(rowElement);
                });
            }

            updateTotal();
        }

        function updateTotal() {
    let total = 0;
    for (const komponen in tableData) {
        tableData[komponen].forEach(row => {
            total += row.Hasil; // Tambahkan hasil dari semua entri
        });
    }
    document.getElementById('total_main').value = total;
}

        function saveData() {
            localStorage.setItem('tableData_radial', JSON.stringify(tableData));
            localStorage.setItem('komponenTotal_radial', JSON.stringify(komponenTotal));
            localStorage.setItem('historyData_radial', JSON.stringify(historyData));
        }

        function showRiwayat() {
            const riwayatSection = document.getElementById('riwayatSection');
            if (riwayatSection.style.display === 'none') {
                riwayatSection.style.display = 'block';
                renderTableRiwayat();
            } else {
                riwayatSection.style.display = 'none';
            }
        }

        function renderTableRiwayat(location = 'all') {
            const tbody = document.getElementById('tabelRiwayat').getElementsByTagName('tbody')[0];
            tbody.innerHTML = '';

            for (const mesin in historyData) {
                if (location === 'all' || mesin === location) {
                    for (const komponen in historyData[mesin]) {
                        historyData[mesin][komponen].forEach((data, index) => {
                            const rowElement = document.createElement('tr');
                            rowElement.innerHTML = `
                                <td>${data.Tanggal}</td>
                                <td>${komponen}</td>
                                <td>${data.Operator}</td>
                                <td>${mesin}</td>
                                <td>${data.Hasil}</td>
                                <td><button onclick="showDeleteConfirmationRiwayat('${mesin}', '${komponen}', ${index})">Hapus</button></td>
                            `;
                            tbody.appendChild(rowElement);
                        });
                    }
                }
            }
        }

        function filterData() {
            const location = document.getElementById('location_riwayat').value;
            renderTableRiwayat(location);
        }

        function exportToExcel() {
            const location = document.getElementById('location_riwayat').value;
            const wb = XLSX.utils.book_new();
            const wsData = [];

            // Header untuk Excel
            const header = ["Tanggal", "Nama Komponen", "Operator", "Mesin", "Hasil"];
            wsData.push(header);

            // Mengisi data berdasarkan lokasi (AVK, RH1-4 atau semua)
            for (const mesin in historyData) {
                if (location === 'all' || mesin === location) {
                    for (const komponen in historyData[mesin]) {
                        historyData[mesin][komponen].forEach(data => {
                            const row = [
                                data.Tanggal,
                                komponen,
                                data.Operator, // Use the stored operator
                                mesin,
                                data.Hasil
                            ];
                            wsData.push(row);
                        });
                    }
                }
            }

            // Membuat worksheet dari data
            const ws = XLSX.utils.aoa_to_sheet(wsData);

            // Mengatur style untuk header (bold dan alignment)
            const headerStyle = {
                font: { bold: true },
                alignment: { horizontal: 'center' }
            };
            for (let col = 0; col < header.length; col++) {
                const cellAddress = XLSX.utils.encode_cell({ r: 0, c: col });
                if (!ws[cellAddress].s) ws[cellAddress].s = {};
                Object.assign(ws[cellAddress].s, headerStyle);
            }

            // Menambahkan border ke semua sel
            const range = XLSX.utils.decode_range(ws['!ref']);
            for (let row = range.s.r; row <= range.e.r; row++) {
                for (let col = range.s.c; col <= range.e.c; col++) {
                    const cellAddress = XLSX.utils.encode_cell({ r: row, c: col });
                    if (!ws[cellAddress].s) ws[cellAddress].s = {};
                    ws[cellAddress].s.border = {
                        top: { style: 'thin' },
                        bottom: { style: 'thin' },
                        left: { style: 'thin' },
                        right: { style: 'thin' }
                    };
                }
            }

            // Menambahkan worksheet ke workbook
            XLSX.utils.book_append_sheet(wb, ws, "Data Komponen");

            // Menyimpan file Excel
            const fileName = location === 'all' ? 'Riwayat_Semua_SMT.xlsx' : `Riwayat_SMT_${location}.xlsx`;
            XLSX.writeFile(wb, fileName);
        }

        function exportTotal() {
            const location = document.getElementById('location_riwayat').value;
            const wb = XLSX.utils.book_new();
            const wsData = [];

            // Header untuk Excel
            const header = ["Tanggal", "Nama Komponen", "Total"];
            wsData.push(header);

            // Mengisi data berdasarkan lokasi (AVK, RH1-4 atau semua)
            const totalData = {};

            for (const mesin in historyData) {
                if (location === 'all' || mesin === location) {
                    for (const komponen in historyData[mesin]) {
                        if (!totalData[komponen]) {
                            totalData[komponen] = { total: 0, tanggal: '' };
                        }

                        historyData[mesin][komponen].forEach(data => {
                            totalData[komponen].total += data.Hasil;
                            totalData[komponen].tanggal = data.Tanggal; // Assuming all dates are the same for simplicity
                        });
                    }
                }
            }

            // Mengisi data ke dalam wsData
            for (const komponen in totalData) {
                const row = [
                    totalData[komponen].tanggal,
                    komponen,
                    totalData[komponen].total
                ];
                wsData.push(row);
            }

            // Membuat worksheet dari data
            const ws = XLSX.utils.aoa_to_sheet(wsData);

            // Mengatur style untuk header (bold dan alignment)
            const headerStyle = {
                font: { bold: true },
                alignment: { horizontal: 'center' }
            };
            for (let col = 0; col < header.length; col++) {
                const cellAddress = XLSX.utils.encode_cell({ r: 0, c: col });
                if (!ws[cellAddress].s) ws[cellAddress].s = {};
                Object.assign(ws[cellAddress].s, headerStyle);
            }

            // Menambahkan border ke semua sel
            const range = XLSX.utils.decode_range(ws['!ref']);
            for (let row = range.s.r; row <= range.e.r; row++) {
                for (let col = range.s.c; col <= range.e.c; col++) {
                    const cellAddress = XLSX.utils.encode_cell({ r: row, c: col });
                    if (!ws[cellAddress].s) ws[cellAddress].s = {};
                    ws[cellAddress].s.border = {
                        top: { style: 'thin' },
                        bottom: { style: 'thin' },
                        left: { style: 'thin' },
                        right: { style: 'thin' }
                    };
                }
            }

            // Menambahkan worksheet ke workbook
            XLSX.utils.book_append_sheet(wb, ws, "Total Komponen");

            // Menyimpan file Excel
            const fileName = location === 'all' ? 'Total_Semua_SMT.xlsx' : `Total_SMT_${location}.xlsx`;
            XLSX.writeFile(wb, fileName);
        }

        function resetData() {
            if (confirm('Apakah Anda yakin ingin mereset semua data?')) {
                localStorage.removeItem('tableData_radial');
                localStorage.removeItem('komponenTotal_radial');
                localStorage.removeItem('historyData_radial');
                tableData = {};
                komponenTotal = {};
                historyData = {
                    'AVK': {},
                    'RH1': {},
                    'RH2': {},
                    'RH3': {},
                    'RH4': {},
                };
                renderTable();
                updateTotal();
                renderTableRiwayat();
                alert('Data telah direset.');
            }
        }
    </script>
</body>
</html>
